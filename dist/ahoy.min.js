((t,e)=>{"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).ahoy={})})(this,function(t){function n(t){return void 0===t}function u(t){return t===Object(t)}function f(t){return Array.isArray(t)}function d(t,e){return e?u(t)&&!n(t.uri):u(t)&&"number"==typeof t.size&&"string"==typeof t.type&&"function"==typeof t.slice}function e(t){return!n(t)&&t}function i(t){void 0===t&&(t={});var n,i,o,r=Object.assign({},{urlPrefix:"",visitsUrl:"/ahoy/visits",eventsUrl:"/ahoy/events",page:null,platform:"Web",useBeacon:!0,startOnReady:!0,trackVisits:!0,cookies:!0,cookieDomain:null,cookiePath:null,cookieNamePrefix:null,headers:{},visitParams:{},withCredentials:!1,visitDuration:240,visitorDuration:1051200},t),a=window.ahoy||window.Ahoy||{},s=(a.configure=function(t){for(var e in t)t.hasOwnProperty(e)&&(r[e]=t[e])},a.configure(a),window.jQuery||window.Zepto||window.$),c=!1,e=[],u="undefined"!=typeof JSON&&void 0!==JSON.stringify,f=[];function d(){return r.urlPrefix+r.eventsUrl}function l(){return(r.useBeacon||r.trackNow)&&(t=r.headers,0===Object.keys(t).length)&&u&&void 0!==window.navigator.sendBeacon&&!r.withCredentials;var t}function h(t){var e=null;return(e=r.cookieNamePrefix?r.cookieNamePrefix+"_"+t:e)||t}function p(t,e,n){I(h(t),e,n,r.cookieDomain||r.domain,r.cookiePath)}function v(t){return M(h(t))}function y(t){I(h(t),"",-1,r.cookieDomain||r.domain,r.cookiePath)}function g(t){v("ahoy_debug")&&window.console.log(t)}function m(){for(var t;t=e.shift();)t();c=!0}function k(t,e,n){document.addEventListener(t,function(t){((t,e)=>{var n=t.matches||t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector;if(n)return n.apply(t,[e]);g("Unable to match")})(t.target,e)&&n(t)})}function w(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}function x(){r.cookies&&u&&p("ahoy_events",JSON.stringify(f),1)}function b(){var t=document.querySelector("meta[name=csrf-token]");return t&&t.content}function _(t){var e=b();e&&t.setRequestHeader("X-CSRF-Token",e)}function A(t,e,n){if(u)if(s&&s.ajax)s.ajax({type:"POST",url:t,data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:_,success:n,headers:r.headers,xhrFields:{withCredentials:r.withCredentials}});else{var i,o=new XMLHttpRequest;for(i in o.open("POST",t,!0),o.withCredentials=r.withCredentials,o.setRequestHeader("Content-Type","application/json"),r.headers)r.headers.hasOwnProperty(i)&&o.setRequestHeader(i,r.headers[i]);o.onload=function(){200===o.status&&n(o.response)},_(o),o.send(JSON.stringify(e))}}function O(t){var e={events:t.events};return r.cookies&&(e.visit_token=t.visit_token,e.visitor_token=t.visitor_token),delete t.visit_token,delete t.visitor_token,e}function S(n,i){a.ready(function(){A(d(),O(n),function(t){i&&i(JSON.parse(t));for(var e=0;e<f.length;e++)if(f[e].id==n.id){f.splice(e,1);break}x()})})}function N(i){a.ready(function(){var t=O(i),e=(e=document.querySelector("meta[name=csrf-param]"))&&e.content,n=b();e&&n&&(t[e]=n),t.events_json=JSON.stringify(t.events),delete t.events,window.navigator.sendBeacon(d(),D(t))})}function P(){return r.page||window.location.pathname}function j(t){return t&&0<t.length?t:null}function V(t){var e,t=t.target,n={tag:t.tagName.toLowerCase(),id:j(t.id),class:j(t.className),page:P(),section:(t=>{for(;t&&t!==document;t=t.parentNode)if(t.hasAttribute("data-section"))return t.getAttribute("data-section");return null})(t)};for(e in n)n.hasOwnProperty(e)&&null===n[e]&&delete n[e];return n}function C(){if(c=!1,n=a.getVisitId(),i=a.getVisitorId(),o=v("ahoy_track"),!1===r.cookies||!1===r.trackVisits)g("Visit tracking disabled"),m();else if(n&&i&&!o)g("Active visit"),m();else if(n||p("ahoy_visit",n=w(),r.visitDuration),v("ahoy_visit")){g("Visit started"),i||p("ahoy_visitor",i=w(),r.visitorDuration);var t,e={visit_token:n,visitor_token:i,platform:r.platform,landing_page:window.location.href,screen_width:window.screen.width,screen_height:window.screen.height,js:!0};for(t in 0<document.referrer.length&&(e.referrer=document.referrer),r.visitParams)r.visitParams.hasOwnProperty(t)&&(e[t]=r.visitParams[t]);g(e),A(r.urlPrefix+r.visitsUrl,e,function(){y("ahoy_track"),m()})}else g("Cookies disabled"),m()}a.ready=function(t){c?t():e.push(t)},a.getVisitId=a.getVisitToken=function(){return v("ahoy_visit")},a.getVisitorId=a.getVisitorToken=function(){return v("ahoy_visitor")},a.prolongVisitExpiration=function(){var t=a.getVisitId(),t=(y("ahoy_visit"),p("ahoy_visit",t,r.visitDuration),a.getVisitorId());y("ahoy_visitor"),p("ahoy_visitor",t,r.visitorDuration)},a.reset=function(){return y("ahoy_visit"),y("ahoy_visitor"),y("ahoy_events"),y("ahoy_track"),!0},a.debug=function(t){return!1===t?y("ahoy_debug"):p("ahoy_debug","t",525600),!0},a.track=function(t,e){var n={events:t.map(function(t){return{name:t.name,properties:t.properties||{},time:(new Date).getTime()/1e3,id:w(),js:!0}})};return a.ready(function(){r.cookies&&!a.getVisitId()&&C(),a.ready(function(){g(n),n.visit_token=a.getVisitId(),n.visitor_token=a.getVisitorId(),l()?N(n):(f.push(n),x(),setTimeout(function(){S(n,e)},1e3))})}),!0},a.trackView=function(t){var e={url:window.location.href,title:document.title,page:P()};if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);a.track([{name:"$view",properties:e}])},a.trackClicks=function(){k("click","a, button, input[type=submit]",function(t){var e=t.target,t=V(t);t.text="input"==t.tag?e.value:(e.textContent||e.innerText||e.innerHTML).replace(/[\s\r\n]+/g," ").trim(),t.href=e.href,a.track([{name:"$click",properties:t}])})},a.trackSubmits=function(){k("submit","form",function(t){t=V(t);a.track([{name:"$submit",properties:t}])})},a.trackChanges=function(){k("change","input, textarea, select",function(t){t=V(t);a.track([{name:"$change",properties:t}])})},a.trackAll=function(){a.trackView(),a.trackClicks(),a.trackSubmits(),a.trackChanges()};try{f=JSON.parse(v("ahoy_events")||"[]")}catch(t){}for(var T=0;T<f.length;T++)S(f[T]);return a.start=function(){C()},t=function(){r.startOnReady&&a.start()},"interactive"===document.readyState||"complete"===document.readyState?setTimeout(t,0):document.addEventListener("DOMContentLoaded",t),a}var D=function i(o,r,a,s){r=r||{},a=a||new FormData,r.indices=e(r.indices),r.nullsAsUndefineds=e(r.nullsAsUndefineds),r.booleansAsIntegers=e(r.booleansAsIntegers),r.allowEmptyArrays=e(r.allowEmptyArrays),r.noAttributesWithArrayNotation=e(r.noAttributesWithArrayNotation),r.noFilesWithArrayNotation=e(r.noFilesWithArrayNotation),r.dotsForObjectNotation=e(r.dotsForObjectNotation);var c="function"==typeof a.getParts;return n(o)||(null===o?r.nullsAsUndefineds||a.append(s,""):"boolean"==typeof o?r.booleansAsIntegers?a.append(s,o?1:0):a.append(s,o):f(o)?o.length?o.forEach(function(t,e){var n,e=s+"["+(r.indices?e:"")+"]";(r.noAttributesWithArrayNotation||r.noFilesWithArrayNotation&&d(n=t,c)&&"string"==typeof n.name&&(u(n.lastModifiedDate)||"number"==typeof n.lastModified))&&(e=s),i(t,r,a,e)}):r.allowEmptyArrays&&a.append(r.noAttributesWithArrayNotation?s:s+"[]",""):o instanceof Date?a.append(s,o.toISOString()):u(o)&&!d(o,c)?Object.keys(o).forEach(function(t){var e=o[t];if(f(e))for(;2<t.length&&t.lastIndexOf("[]")===t.length-2;)t=t.substring(0,t.length-2);var n=s?r.dotsForObjectNotation?s+"."+t:s+"["+t+"]":t;i(e,r,a,n)}):a.append(s,o)),a},I=function(t,e,n,i,o){var r,a="",s="",c="";n&&((r=new Date).setTime(r.getTime()+60*n*1e3),a="; expires="+r.toGMTString()),i&&(s="; domain="+i),c=o?"; path="+o:"; path=/",document.cookie=t+"="+escape(e)+a+s+c},M=function(t){for(var e,n=t+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){for(e=i[o];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(n))return unescape(e.substring(n.length,e.length))}return null},o=i();t.default=o,t.initializeAhoyInstance=i,Object.defineProperty(t,"__esModule",{value:!0})});
