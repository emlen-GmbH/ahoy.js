!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).ahoy={})}(this,function(e){"use strict";function a(e){return void 0===e}function s(e){return Array.isArray(e)}function c(e){return e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.slice}function t(e){void 0===e&&(e={});var r=Object.assign({},{urlPrefix:"",visitsUrl:"/ahoy/visits",eventsUrl:"/ahoy/events",page:null,platform:"Web",useBeacon:!0,startOnReady:!0,trackVisits:!0,cookies:!0,cookieDomain:null,cookiePath:null,cookieNamePrefix:null,headers:{},visitParams:{},withCredentials:!1,visitDuration:240,visitorDuration:1051200},e),i=window.ahoy||window.Ahoy||{};i.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])},i.configure(i);var n,o,a,s=window.jQuery||window.Zepto||window.$,c=!1,t=[],u="undefined"!=typeof JSON&&void 0!==JSON.stringify,f=[];function d(){return r.urlPrefix+r.eventsUrl}function l(){return(r.useBeacon||r.trackNow)&&(e=r.headers,0===Object.keys(e).length)&&u&&void 0!==window.navigator.sendBeacon&&!r.withCredentials;var e}function h(e){var t=null;return r.cookieNamePrefix&&(t=r.cookieNamePrefix+"_"+e),t||e}function v(e,t,n){M(h(e),t,n,r.cookieDomain||r.domain,r.cookiePath)}function g(e){return U(h(e))}function p(e){M(h(e),"",-1,r.cookieDomain||r.domain,r.cookiePath)}function y(e){g("ahoy_debug")&&window.console.log(e)}function m(){for(var e;e=t.shift();)e();c=!0}function k(e,o,r){document.addEventListener(e,function(e){var t,n,i;t=e.target,n=o,((i=t.matches||t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector)?i.apply(t,[n]):void y("Unable to match"))&&r(e)})}function x(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function w(){r.cookies&&u&&v("ahoy_events",JSON.stringify(f),1)}function _(){var e=document.querySelector("meta[name=csrf-token]");return e&&e.content}function b(e){var t=_();t&&e.setRequestHeader("X-CSRF-Token",t)}function S(e,t,n){if(u)if(s&&s.ajax)s.ajax({type:"POST",url:e,data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:b,success:n,headers:r.headers,xhrFields:{withCredentials:r.withCredentials}});else{var i=new XMLHttpRequest;for(var o in i.open("POST",e,!0),i.withCredentials=r.withCredentials,i.setRequestHeader("Content-Type","application/json"),r.headers)r.headers.hasOwnProperty(o)&&i.setRequestHeader(o,r.headers[o]);i.onload=function(){200===i.status&&n()},b(i),i.send(JSON.stringify(t))}}function O(e){var t={events:[e]};return r.cookies&&(t.visit_token=e.visit_token,t.visitor_token=e.visitor_token),delete e.visit_token,delete e.visitor_token,t}function P(t){i.ready(function(){S(d(),O(t),function(){for(var e=0;e<f.length;e++)if(f[e].id==t.id){f.splice(e,1);break}w()})})}function V(o){i.ready(function(){var e,t=O(o),n=(e=document.querySelector("meta[name=csrf-param]"))&&e.content,i=_();n&&i&&(t[n]=i),t.events_json=JSON.stringify(t.events),delete t.events,window.navigator.sendBeacon(d(),N(t))})}function A(){return r.page||window.location.pathname}function j(e){return e&&0<e.length?e:null}function C(e){var t=e.target;return function(e){for(var t in e)e.hasOwnProperty(t)&&null===e[t]&&delete e[t];return e}({tag:t.tagName.toLowerCase(),id:j(t.id),class:j(t.className),page:A(),section:function(e){for(;e&&e!==document;e=e.parentNode)if(e.hasAttribute("data-section"))return e.getAttribute("data-section");return null}(t)})}function I(){if(c=!1,n=i.getVisitId(),o=i.getVisitorId(),a=g("ahoy_track"),!1===r.cookies||!1===r.trackVisits)y("Visit tracking disabled"),m();else if(n&&o&&!a)y("Active visit"),m();else if(n||v("ahoy_visit",n=x(),r.visitDuration),g("ahoy_visit")){y("Visit started"),o||v("ahoy_visitor",o=x(),r.visitorDuration);var e={visit_token:n,visitor_token:o,platform:r.platform,landing_page:window.location.href,screen_width:window.screen.width,screen_height:window.screen.height,js:!0};for(var t in 0<document.referrer.length&&(e.referrer=document.referrer),r.visitParams)r.visitParams.hasOwnProperty(t)&&(e[t]=r.visitParams[t]);y(e),S(r.urlPrefix+r.visitsUrl,e,function(){p("ahoy_track"),m()})}else y("Cookies disabled"),m()}i.ready=function(e){c?e():t.push(e)},i.getVisitId=i.getVisitToken=function(){return g("ahoy_visit")},i.getVisitorId=i.getVisitorToken=function(){return g("ahoy_visitor")},i.prolongVisitExpiration=function(){var e=i.getVisitId();p("ahoy_visit"),v("ahoy_visit",e,r.visitDuration);var t=i.getVisitorId();p("ahoy_visitor"),v("ahoy_visitor",t,r.visitorDuration)},i.reset=function(){return p("ahoy_visit"),p("ahoy_visitor"),p("ahoy_events"),p("ahoy_track"),!0},i.debug=function(e){return!1===e?p("ahoy_debug"):v("ahoy_debug","t",525600),!0},i.track=function(e,t){var n={name:e,properties:t||{},time:(new Date).getTime()/1e3,id:x(),js:!0};return i.ready(function(){r.cookies&&!i.getVisitId()&&I(),i.ready(function(){y(n),n.visit_token=i.getVisitId(),n.visitor_token=i.getVisitorId(),l()?V(n):(f.push(n),w(),setTimeout(function(){P(n)},1e3))})}),!0},i.trackView=function(e){var t={url:window.location.href,title:document.title,page:A()};if(e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.track("$view",t)},i.trackClicks=function(){k("click","a, button, input[type=submit]",function(e){var t=e.target,n=C(e);n.text="input"==n.tag?t.value:(t.textContent||t.innerText||t.innerHTML).replace(/[\s\r\n]+/g," ").trim(),n.href=t.href,i.track("$click",n)})},i.trackSubmits=function(){k("submit","form",function(e){var t=C(e);i.track("$submit",t)})},i.trackChanges=function(){k("change","input, textarea, select",function(e){var t=C(e);i.track("$change",t)})},i.trackAll=function(){i.trackView(),i.trackClicks(),i.trackSubmits(),i.trackChanges()};try{f=JSON.parse(g("ahoy_events")||"[]")}catch(e){}for(var T,D=0;D<f.length;D++)P(f[D]);return i.start=function(){I()},T=function(){r.startOnReady&&i.start()},"interactive"===document.readyState||"complete"===document.readyState?setTimeout(T,0):document.addEventListener("DOMContentLoaded",T),i}var u=function(n,i,o,r){return(i=i||{}).indices=!a(i.indices)&&i.indices,i.nullsAsUndefineds=!a(i.nullsAsUndefineds)&&i.nullsAsUndefineds,i.booleansAsIntegers=!a(i.booleansAsIntegers)&&i.booleansAsIntegers,o=o||new FormData,a(n)||(null===n?i.nullsAsUndefineds||o.append(r,""):"boolean"==typeof n?i.booleansAsIntegers?o.append(r,n?1:0):o.append(r,n):s(n)?n.length&&n.forEach(function(e,t){var n=r+"["+(i.indices?t:"")+"]";u(e,i,o,n)}):n instanceof Date?o.append(r,n.toISOString()):(t=n)!==Object(t)||c(e=n)&&"string"==typeof e.name&&("object"==typeof e.lastModifiedDate||"number"==typeof e.lastModified)||c(n)?o.append(r,n):Object.keys(n).forEach(function(e){var t=n[e];if(s(t))for(;2<e.length&&e.lastIndexOf("[]")===e.length-2;)e=e.substring(0,e.length-2);u(t,i,o,r?r+"["+e+"]":e)})),o;var e,t},N={serialize:u}.serialize,M=function(e,t,n,i,o){var r,a="",s="",c="";n&&((r=new Date).setTime(r.getTime()+60*n*1e3),a="; expires="+r.toGMTString()),i&&(s="; domain="+i),c=o?"; path="+o:"; path=/",document.cookie=e+"="+escape(t)+a+s+c},U=function(e){for(var t,n=e+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){for(t=i[o];" "===t.charAt(0);)t=t.substring(1,t.length);if(0===t.indexOf(n))return unescape(t.substring(n.length,t.length))}return null},n=t();e.default=n,e.initializeAhoyInstance=t,Object.defineProperty(e,"__esModule",{value:!0})});
